# [RFC] コミュニケーション原則ルールの新設と既存コマンドへの適用

| 項目 | 内容 |
| :--- | :--- |
| **作成者 (Author)** | Claude (RFC Author) |
| **ステータス** | Accepted (承認済) |
| **作成日** | 2026-02-13 |
| **タグ** | rules, communication, commands |
| **関連リンク** | なし |

<!-- 記述形式ルール（全セクション共通）:
1. 80文字上限: 1箇条書き項目・1テーブルセルは80文字以内
   80文字に収まらない場合はサブ項目分割またはテーブル行分割
2. 散文禁止（例外あり）:
   §1のみ散文許可（5文以内）
   §11のコードブロック間補足は2文以内の散文許可
   他セクションは散文禁止でテーブルまたは箇条書きのみ
3. §1-5 コード識別子禁止:
   バッククォートで囲まれたコード識別子の使用を禁止
   （ファイル名、関数名、変数名、パス、コマンド）
   機能名称またはドメイン用語で記述すること
-->

## 1. 背景・動機 (Motivation)

<!-- 散文で記述。ただし5文以内。 -->

開発フロー全般において、選択肢を並列に列挙し「どれにしますか？」と聞くメニュー提示型の応答が頻発している。PRコメント対応コマンドのStep 5-6が「論点を提示し、ユーザの判断を仰ぐ」と指示しており、メニュー提示を直接誘導している。ルール定義にコミュニケーション品質や思考態度に関する規定が一切存在せず、LLMの迎合バイアスに対抗する明示的な義務が未定義である。推奨先行と全体最適の2原則をルールとして定義し、関連コマンドの指示文言を整合させることで、コミュニケーション品質を構造的に改善する。

## 2. 機能要件

### 達成すべき要件

<!-- コード識別子禁止。機能名称またはドメイン用語で記述。 -->

| ID | 要件 |
|----|------|
| F1 | コミュニケーション原則ルールを新設し、推奨先行の原則を定義する |
| F2 | コミュニケーション原則ルールに全体最適の原則を定義する |
| F3 | PRコメント対応コマンドのStep 5カテゴリBの対応指示を推奨先行に変更する |
| F4 | PRコメント対応コマンドのStep 6の対話指示を推奨先行に変更する |
| F5 | 実装開始コマンドのStep 5の設計問題報告指示を推奨先行に変更する |
| F6 | 相談コマンドのStep 3.4を全体最適の原則への参照に変更する |

### やらないこと

- 既存の全コマンド定義の網羅的見直し
- LLMの応答品質を自動検証する仕組みの構築

## 3. 非機能要件

### 達成すべき要件

| ID | 分類 | 要件 |
|----|------|------|
| N1 | 一貫性 | 推奨先行の原則がルール定義と各コマンド指示で矛盾なく適用されること |
| N2 | 適用範囲 | コミュニケーション原則はすべてのコマンド・すべての対話に適用されること |

### やらないこと

- コマンド外の自由会話に対する個別の指示追加（ルールで包括的に規定するため不要）

## 4. 実現方式

<!-- 機能要件・非機能要件をどう実現するかの高レベル方針。 -->

| 要件 | 実現方式 |
|------|----------|
| F1-F2 コミュニケーション原則の定義 | ルール定義ファイルを新設し、推奨先行・全体最適の2原則と禁止パターンを記述する |
| F3-F4 PRコメント対応コマンドの修正 | Step 5のカテゴリBテーブルとStep 6の対話指示を推奨先行型の文言に書き換える |
| F5 実装開始コマンドの修正 | Step 5の設計問題報告指示を推奨先行型の文言に書き換える |
| F6 相談コマンドの修正 | Step 3.4の局所最適回避指示をルールへの参照に置き換える |
| N1-N2 一貫性と適用範囲 | ルールに「すべてのコマンド・すべての対話」を適用範囲と明記する |

## 5. 代替案の検討

<!-- §4の実現方式に対する代替案。最低2案を比較。 -->

| 案 | 概要 | 採否 | 決定的理由 |
|----|------|------|------------|
| A: ルール新設+コマンド修正 | 独立したルールファイルで原則を定義し、各コマンドの指示文言を整合させる | **採用** | ルールが全対話に適用され、コマンド修正で既知の誘導箇所も直接排除できる |
| B: コマンド修正のみ | 各コマンドの指示文言のみを修正し、独立したルールファイルは作成しない | 却下 | コマンド外の自由会話に原則が適用されず、新規コマンド追加時にも漏れが発生する |
| C: ルール新設のみ | ルールファイルのみ新設し、既存コマンドの文言は修正しない | 却下 | コマンド内の明示的な誘導指示がルールと矛盾し、コマンド指示が優先される可能性がある |

## 6. 外部仕様 (External Specification)

<!-- ユーザ・運用者視点の振る舞い。箇条書き＋コード例。 -->

- すべての対話において、判断を求める場面では推奨案が理由とともに先行提示される
- 選択肢を並列に列挙し「どれにしますか？」と聞く応答が禁止される
- 既存のコード・構成・慣習が疑われ、あるべき姿との乖離がある場合は既存を否定する提案がなされる
- 対症療法ではなく原因構造まで遡った根本解決が提案される
- ユーザやレビュアーの指摘が部分最適に留まる場合、その旨が率直に述べられる

### PRコメント対応コマンドの変更例

```
# 旧: カテゴリBの対応
ユーザと対話し合意形成後に対応を決定する

# 新: カテゴリBの対応
推奨する対応案を理由とともに提示し、ユーザの承認を得て対応を決定する
```

### 実装開始コマンドの変更例

```
# 旧: Step 5の設計問題報告
実装中に設計上の問題を発見した場合は、ユーザに報告し判断を仰ぐこと。

# 新: Step 5の設計問題報告
実装中に設計上の問題を発見した場合は、推奨する対処案を理由とともにユーザに報告し、承認を得て対応すること。
```

## 7. 結合テスト仕様

<!-- /vfyで実施するテスト。要件寄りで記述。 -->

| ID | 対応要件 | テスト内容 | 期待結果 |
|----|----------|------------|----------|
| T1 | F1 | コミュニケーション原則ルールファイルに推奨先行の原則が記載されているか確認する | 推奨先行の原則・具体手順・禁止パターンが記載されている |
| T2 | F2 | コミュニケーション原則ルールファイルに全体最適の原則が記載されているか確認する | 全体最適の原則と3つの行動指針が記載されている |
| T3 | F1-F2 | コミュニケーション原則ルールの適用範囲を確認する | 「すべてのコマンド・すべての対話」と明記されている |
| T4 | F3 | PRコメント対応コマンドのStep 5カテゴリB対応列を確認する | 推奨先行型の文言に変更されている |
| T5 | F4 | PRコメント対応コマンドのStep 6の対話指示を確認する | 推奨先行型の文言に変更されている |
| T6 | F5 | 実装開始コマンドのStep 5の設計問題報告指示を確認する | 推奨先行型の文言に変更されている |
| T7 | F6 | 相談コマンドのStep 3.4を確認する | 全体最適の原則への参照に変更されている |
| T8 | N1 | ルール定義と各コマンド指示の間で推奨先行の表現に矛盾がないか確認する | 矛盾がない |

## 8. ドキュメント編集仕様

<!-- システム概要ドキュメント等の作成・更新・削除。 -->

| 対象ファイル | 操作 | 変更内容 |
|-------------|------|----------|
| コミュニケーション原則ルール | 作成 | 推奨先行の原則・全体最適の原則を定義 |
| PRコメント対応コマンド | 更新 | Step 5カテゴリB対応列・Step 6対話指示を推奨先行型に変更 |
| 実装開始コマンド | 更新 | Step 5設計問題報告指示を推奨先行型に変更 |
| 相談コマンド | 更新 | Step 3.4を全体最適の原則への参照に変更 |

システム概要ドキュメント（`docs/architecture.md`, `docs/domain-model.md`, `docs/api-overview.md`）は本リポジトリに存在しないため、更新対象はない。

## 9. Task計画

<!-- Phase/フェーズによる作業分割を禁止する。 -->
<!-- 全作業項目は単一のPRで完遂すること。 -->

| # | 種別 | 作業内容 | 依存 |
|---|------|----------|------|
| 1 | コード | コミュニケーション原則ルールファイルの新設（推奨先行の原則・全体最適の原則） | - |
| 2 | コード | PRコメント対応コマンドのStep 5カテゴリB対応列とStep 6対話指示の修正 | - |
| 3 | コード | 実装開始コマンドのStep 5設計問題報告指示の修正 | - |
| 4 | コード | 相談コマンドのStep 3.4の修正 | - |
| 5 | テスト | 結合テスト仕様に基づく全テスト実行 | #1-#4 |

### ロールバック基準と手順

- **基準**: 変更後のルールやコマンド指示が意図しない応答品質の低下を引き起こす場合
- **手順**: 全変更がMarkdownファイルのテキスト修正であるため、`git revert` で完了する

## 10. 前提条件・依存関係

| 種別 | 内容 |
|------|------|
| ファイル依存 | 変更対象は全てMarkdownファイルであり、外部ツール・ライブラリへの依存はない |
| 前提 | ルール定義ディレクトリが存在し、配下のMarkdownファイルが自動的に読み込まれること |

## 11. 詳細設計 (Detailed Design)

<!-- 箇条書き＋コード例。 -->
<!-- コードブロック間補足は2文以内の散文許可。 -->

### 11.1 コミュニケーション原則ルールファイル

`adapters/claude/rules/communication.md` を以下の内容で新設する。

```markdown
# コミュニケーション原則

## 適用範囲

すべてのコマンド・すべての対話に適用する。

## 推奨先行の原則（Propose-first）

ユーザに判断を求める場面では、以下の手順に従え:

1. 推奨案を1つ、理由とともに提示する
2. 代替案がある場合はトレードオフとともに補足する
3. ユーザの承認または修正を受けて進める

### 禁止パターン

- 選択肢を並列に列挙し「どれにしますか？」と聞く応答
- 推奨を示さず論点だけを提示する応答
- 「〜という方法もありますが、〜という方法もあります」と等価に並べる応答

## 全体最適の原則

提案・修正・回答のすべてにおいて、以下に従え:

1. **既存の前提を疑え**: 既存のコード・構成・慣習が正しいとは限らない。「なぜこうなっているのか」を問い、あるべき姿と乖離している場合は既存を否定する提案をせよ
2. **対症療法を禁止する**: 目の前の症状を消すだけの修正を提案するな。その症状が生じている原因構造まで遡り、根本から解決する方向を示せ
3. **部分最適を指摘せよ**: ユーザやレビュアーの指摘自体が部分最適に留まっていると判断した場合、その旨を率直に述べ、全体最適の観点から対案を示せ
```

### 11.2 PRコメント対応コマンドの修正（2箇所）

Step 5 カテゴリBテーブルの「対応」列を修正する。

```markdown
# 旧
| **B: 要ディスカッション** | 相談ベースのコメント、設計判断を伴うもの、複数の解釈がありうるもの | ユーザと対話し合意形成後に対応を決定する |

# 新
| **B: 要ディスカッション** | 相談ベースのコメント、設計判断を伴うもの、複数の解釈がありうるもの | 推奨する対応案を理由とともに提示し、ユーザの承認を得て対応を決定する |
```

Step 6 の対話指示を修正する。

```markdown
# 旧
1. **ユーザと terminal 上で対話する。** 各コメントについて論点を提示し、ユーザの判断を仰ぐ。

# 新
1. **ユーザと terminal 上で対話する。** 各コメントについて推奨する対応を理由とともに提示し、ユーザの承認または修正を受ける。
```

### 11.3 実装開始コマンドの修正（1箇所）

Step 5 の設計問題報告指示を修正する。

```markdown
# 旧
- 実装中に設計上の問題を発見した場合は、ユーザに報告し判断を仰ぐこと。

# 新
- 実装中に設計上の問題を発見した場合は、推奨する対処案を理由とともにユーザに報告し、承認を得て対応すること。
```

### 11.4 相談コマンドの修正（1箇所）

Step 3.4 の局所最適回避指示を修正する。

```markdown
# 旧
4. **局所最適を避けよ**: 相談箇所単体の最適化ではなく、システム全体の一貫性・保守性への影響を評価せよ

# 新
4. **全体最適の原則に従え**: rules/communication.md の「全体最適の原則」に従え
```

### 単体テスト仕様

| テスト対象 | 検証観点 |
|-----------|----------|
| コミュニケーション原則ルール | 推奨先行の原則に手順3点と禁止パターン3点が含まれること |
| コミュニケーション原則ルール | 全体最適の原則に行動指針3点が含まれること |
| コミュニケーション原則ルール | 適用範囲に「すべてのコマンド・すべての対話」が明記されていること |
| PRコメント対応コマンド | Step 5カテゴリBに旧文言「ユーザと対話し合意形成後に」が残存しないこと |
| PRコメント対応コマンド | Step 6に旧文言「論点を提示し、ユーザの判断を仰ぐ」が残存しないこと |
| 実装開始コマンド | Step 5に旧文言「ユーザに報告し判断を仰ぐ」が残存しないこと |
| 相談コマンド | Step 3.4に旧文言「局所最適を避けよ」が残存しないこと |
| 相談コマンド | Step 3.4にルール参照が含まれること |
