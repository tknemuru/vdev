# [RFC] Goals 達成確認の厳格化 — Verification トートロジーとエビデンス形骸化の防止

| 項目 | 内容 |
| :--- | :--- |
| **作成者 (Author)** | AI (Claude) |
| **ステータス** | Draft (起草中) |
| **作成日** | 2026-02-10 |
| **タグ** | workflow, quality-assurance |
| **関連リンク** | RFC `20260209-enforce-rfc-goal-verification`, [dre#56](https://github.com/tknemuru/dre/pull/56), `docs/reports/20260210-report-goal-verification-enforcement-analysis.md` |

## 1. 要約 (Summary)

- RFC `20260209-enforce-rfc-goal-verification` で Goals 達成確認の仕組みを導入したが、初回適用事例（dre リポジトリ PR #56）で2つの抜け穴が判明した。Verification のトートロジー（「記載があること」等の実装と同義の確認方法）と、エビデンスの形骸化（「実装済み」を根拠とする記述）である。
- 本 RFC では、RFC テンプレート・RFC レビュー基準・`/imp` コマンド・実装レビュー基準の4箇所を同時に修正し、Verification とエビデンスの質を担保する仕組みを導入する。
- 具体的には、Verification にトートロジー禁止の制約を追加し、エビデンスとして「実装行為の記述」を明示的に禁止する。

## 2. 背景・動機 (Motivation)

- RFC `20260209-enforce-rfc-goal-verification` により、Goals 達成確認の強制化を実現した。RFC テンプレートへの Verification 列追加、RFC レビュー基準への検証可能性チェック追加、`/imp` コマンドへの達成確認ステップ追加、実装レビュー基準へのエビデンス確認追加の4点である。
- しかし、初回適用事例（dre リポジトリ PR #56）において、仕組みの「抜け穴」が2つ発覚した。詳細な分析はレポート `docs/reports/20260210-report-goal-verification-enforcement-analysis.md` に記載されている。
- **問題1: Verification のトートロジー**: G3 の Verification は「`explore.md` にタイムアウト手順の記載があること」であった。これは実装すれば自動的に達成するため、Goals の達成確認として機能しない。「記載があること」は実装行為そのものであり、実装とは独立した検証になっていない。
- **問題2: エビデンスの形骸化**: G1, G2 の Verification には「実行して確認」と記載されていたにもかかわらず、エビデンスは「ポーリングスクリプトを追記済み」「Step 3.5 を追加」等、コードを書いたことの記述にとどまっていた。AI は Verification の指示を無視し、最も低コストな「目視確認」に流れている。
- 根本原因は、現行の `/imp` Step 7 の「目視確認など」という表現が逃げ道になっていること、および Verification 自体にトートロジー的記述を許容していることである。
- 放置した場合、Goals 達成確認の仕組みが形骸化し、RFC `20260209-enforce-rfc-goal-verification` で解決しようとした問題が実質的に未解決のまま残る。

## 3. 目的とスコープ (Goals & Non-Goals)

### 目的 (Goals)

| # | Goal | 達成確認方法 (Verification) |
|---|------|-----------------------------|
| G1 | `/imp` の Step 7 で、Verification に記載されたコマンド・手順をそのまま実行することを明示し、「実装済み」をエビデンスとして認めない制約を追加する | `adapters/claude/commands/imp.md` の Step 7 を Read で読み込み、(1)「そのまま実行」の指示、(2)「〜を追記済み」「〜を実装済み」はエビデンスとして認めないという禁止規定、(3) エビデンス欄に「実行したコマンドの出力、読み込んだファイルの該当箇所の引用」が例示されていることを引用で確認する |
| G2 | RFC テンプレートの Verification 記述ガイドに、トートロジー禁止の制約を追加する | `templates/rfc/rfc-default.md` の Goals テーブルを Read で読み込み、「記載があること」のような実装と同義の確認は不可という制約文言が含まれていることを引用で確認する |
| G3 | RFC レビュー基準にトートロジー検出の観点を追加し、P0 として指摘する旨を明記する | `prompts/criterias/rfc-review.md` の Approach Reviewer セクションを Read で読み込み、(1) トートロジー的な確認方法を P0 として指摘する旨、(2)「〜が記載されていること」等の具体例が列挙されていることを引用で確認する |
| G4 | 実装レビュー基準のエビデンス検証を厳格化し、「実装済み」をエビデンスとして認めない旨を明記する | `prompts/criterias/impl-review.md` の Approach Reviewer セクションを Read で読み込み、(1)「〜を実装済み」等がエビデンスとして不十分であるという禁止規定、(2) Verification に記載されたコマンドや手順を実行した結果が必要という要件が含まれていることを引用で確認する |

### やらないこと (Non-Goals)

- Verification の自動検証ツールの開発は行わない。検証の実行は AI エージェントが担う。
- 既存の承認済み RFC の Verification を遡及的に修正することは行わない。
- `/imp` コマンド以外のコマンド（`/rfc`, `/rrfc` 等）の変更は行わない（ただし RFC テンプレートとレビュー基準の変更は `/rfc` と `/rrfc` の動作に間接的に影響する）。

## 4. 前提条件・依存関係 (Prerequisites & Dependencies)

- RFC `20260209-enforce-rfc-goal-verification` が承認・マージ済みであること。本 RFC は当該 RFC で導入された Goals テーブル形式・達成確認ステップを前提とし、その上に制約を追加する。
- 変更対象は vdev リポジトリ内のワークフロー定義ファイル（Markdown）のみである。外部ツールやライブラリへの依存はない。

## 5. 詳細設計 (Detailed Design)

### 5.1 変更対象ファイル一覧

| # | ファイル | 変更概要 |
|---|---------|---------|
| 1 | `adapters/claude/commands/imp.md` | Step 7 の達成確認手順を厳格化 |
| 2 | `templates/rfc/rfc-default.md` | Goals テーブルの Verification プレースホルダにトートロジー禁止の制約を追加 |
| 3 | `prompts/criterias/rfc-review.md` | Approach Reviewer の Verification チェック項目にトートロジー検出を追加 |
| 4 | `prompts/criterias/impl-review.md` | Approach Reviewer のエビデンス確認項目を厳格化 |

### 5.2 変更1: `/imp` の Goals 達成確認ステップの厳格化

**対象ファイル**: `adapters/claude/commands/imp.md`

**変更箇所**: Step 7 全体を置き換える。

現行の Step 7:
```markdown
### Step 7: Goals 達成確認

1. Step 3 で読み込んだ RFC の Goals テーブルから、各 Goal の `#`、`Goal`、`達成確認方法 (Verification)` を抽出する。
2. 各 Goal の Verification を順に実行する（コマンド実行、テスト結果確認、ファイル内容の目視確認など）。
3. 達成確認結果を以下のテーブル形式でまとめる:

| # | Goal | Verification | 結果 | エビデンス |
|---|------|-------------|------|-----------|
| G1 | {Goal内容} | {確認方法} | OK / NG | {確認結果の詳細。コマンド出力、確認した内容等} |

4. NG の Goal がある場合はユーザに報告し、続行するか確認する。
5. 達成確認結果は Step 8 の PR 作成時に本文へ含める。
```

変更後の Step 7:
```markdown
### Step 7: Goals 達成確認

1. Step 3 で読み込んだ RFC の Goals テーブルから、各 Goal の `#`、`Goal`、`達成確認方法 (Verification)` を抽出する。
2. 各 Goal の Verification を順に実行する。
   - Verification に記載されたコマンド・手順を**そのまま実行**せよ。
   - 「目視確認」「記載があること」等の確認は、対象ファイルの該当箇所を Read で読み込み、期待する内容が存在することを引用で示せ。
   - **「〜を追記済み」「〜を実装済み」はエビデンスとして認めない。** 実装したことは diff から自明であり、Verification の目的は「実装した結果として目的が達成されたか」の確認である。
3. 達成確認結果を以下のテーブル形式でまとめる:

| # | Goal | Verification | 結果 | エビデンス |
|---|------|-------------|------|-----------|
| G1 | {Goal内容} | {確認方法} | OK / NG | {**実行したコマンドの出力、読み込んだファイルの該当箇所の引用、スクリーンショットのパスなど**} |

4. NG の Goal がある場合はユーザに報告し、続行するか確認する。
5. 達成確認結果は Step 8 の PR 作成時に本文へ含める。
```

変更のポイント:
- 「コマンド実行、テスト結果確認、ファイル内容の目視確認など」という曖昧な列挙を廃止し、「そのまま実行」という明確な指示に変更する。
- 「目視確認」が必要な場合も、Read で該当箇所を読み込み引用で示すことを要求する。これにより「目視で確認した」という自己申告を排除する。
- 「〜を実装済み」をエビデンスとして明示的に禁止し、その理由を記載する。
- エビデンス欄の例示を「確認結果の詳細。コマンド出力、確認した内容等」から「実行したコマンドの出力、読み込んだファイルの該当箇所の引用、スクリーンショットのパスなど」に変更し、期待するエビデンスの具体性を引き上げる。

### 5.3 変更2: RFC テンプレートの Verification 記述ガイド強化

**対象ファイル**: `templates/rfc/rfc-default.md`

**変更箇所**: Goals テーブルの Verification 列のプレースホルダ。

現行:
```markdown
| G1 | {達成すべき具体的な目標} | {どのような手段で達成を確認するか。計測コマンド、テストケース、目視確認手順など具体的に記述} |
```

変更後:
```markdown
| G1 | {達成すべき具体的な目標} | {実装完了後に達成を検証する具体的手順。「記載があること」のような実装と同義の確認は不可。コマンド実行結果、テスト通過、動作確認手順など、実装とは独立した検証手段を記述すること} |
```

変更のポイント:
- 「どのような手段で達成を確認するか」という漠然とした問いかけを、「実装完了後に達成を検証する具体的手順」に変更し、実装後の検証であることを明示する。
- 「記載があること」のような実装と同義の確認を不可と明記し、トートロジーを RFC 起草段階で排除する。
- 「実装とは独立した検証手段」という基準を示し、Verification の本来の目的を明確にする。

### 5.4 変更3: RFC レビュー基準にトートロジー検出を追加

**対象ファイル**: `prompts/criterias/rfc-review.md`

**変更箇所**: Approach Reviewer セクションの Verification チェック項目。

現行:
```markdown
- 各 Goal に対して具体的な達成確認方法（Verification）が定義されているか。「検討する」「評価する」等の曖昧な記述ではなく、実行可能な確認手順（計測コマンド、テストケース、目視確認手順等）が示されていること。
```

変更後:
```markdown
- 各 Goal に対して具体的な達成確認方法（Verification）が定義されているか。以下に該当する場合は P0 として指摘すること:
  - 「検討する」「評価する」等の曖昧な記述
  - 「〜が記載されていること」「〜が追加されていること」等、実装完了と同義になるトートロジー的な確認方法
  - 実行可能な確認手順（計測コマンド、テストケース、動作確認手順等）が示されていないもの
```

変更のポイント:
- 既存の「曖昧な記述」の検出に加え、「トートロジー的な確認方法」を新たな検出対象として追加する。
- 該当する場合は P0 として指摘することを明記し、強制力を持たせる。
- 「目視確認手順」を「動作確認手順」に変更する。「目視確認」は曖昧な逃げ道になりうるため、より具体的な表現に改める。

### 5.5 変更4: 実装レビュー基準のエビデンス検証厳格化

**対象ファイル**: `prompts/criterias/impl-review.md`

**変更箇所**: Approach Reviewer セクションのエビデンス確認項目。

現行:
```markdown
- RFC の各 Goal に対する達成確認結果（エビデンス）がPRに記載されているか。エビデンスが不足または不明確な場合は P0 として指摘すること。
```

変更後:
```markdown
- RFC の各 Goal に対する達成確認結果（エビデンス）がPRに記載されているか。以下に該当する場合は P0 として指摘すること:
  - エビデンスが「〜を実装済み」「〜を追記済み」等、実装行為の記述にとどまるもの（実装は diff から自明であり、エビデンスではない）
  - Verification に記載されたコマンドや手順を実行した結果が示されていないもの
  - エビデンスが不足または不明確なもの
```

変更のポイント:
- 「エビデンスが不足または不明確な場合」という抽象的な基準を、具体的な判定条件に分解する。
- 「実装行為の記述」がエビデンスとして不十分である理由（「実装は diff から自明」）を明記し、レビュアーが一貫した判断を下せるようにする。
- Verification に記載されたコマンドや手順を実行した結果が必要であることを明示する。

## 6. 代替案の検討 (Alternatives Considered)

### 案A: 4箇所同時修正による多層防御の強化（採用案）

- **概要**: RFC テンプレート（起草時の制約）、RFC レビュー基準（設計レビュー時の検出）、`/imp` コマンド（実装時の実行規約）、実装レビュー基準（実装レビュー時の検出）の4箇所を同時に修正し、ワークフロー全段階でトートロジーと形骸化を防止する。
- **長所**: 前回の RFC `20260209-enforce-rfc-goal-verification` と同じ多層防御アプローチを踏襲しつつ、各層の制約を具体化する。1箇所のみの修正では別の段階で抜け穴が残る。
- **短所**: 変更箇所が4ファイルに分散する。ただし、いずれも Markdown の軽微な文言修正であり、実装コストは低い。

### 案B: `/imp` コマンドのみ修正

- **概要**: エビデンスの形骸化が直接発生する `/imp` の Step 7 のみを厳格化し、RFC テンプレートやレビュー基準は変更しない。
- **長所**: 変更範囲が最小限で、影響が小さい。
- **短所**: Verification のトートロジー（問題1）に対処できない。RFC 起草段階でトートロジー的な Verification が設定された場合、`/imp` でいくら厳格に実行しても「記載があること」を引用で示すだけの形骸化した確認になる。入力（Verification の質）を制御しなければ、出力（エビデンスの質）は改善しない。

### 案C: Verification の自動検証ツール開発

- **概要**: Verification の記述を解析し、トートロジーや曖昧な表現を自動検出するツールを開発する。
- **長所**: 人的・AI 的な判断のばらつきを排除できる。
- **短所**: 自然言語の意味解析が必要であり、ルールベースでの網羅は困難である。過検出・未検出のチューニングコストが高い。現時点ではレビュー基準による人的/AI的検出で十分であり、ツール開発の費用対効果が低い。

### 選定理由

- 案A を採用する。今回の問題は「仕組みの抜け穴」であり、入力段階（RFC テンプレート・RFC レビュー）と出力段階（`/imp` コマンド・実装レビュー）の両方を同時に修正しなければ根本解決にならない。案B は出力段階のみの対処であり、案C は現時点では過剰投資である。

## 7. 横断的関心事 (Cross-Cutting Concerns)

### 7.1 セキュリティとプライバシー

- 対象はワークフロー定義ファイル（Markdown）のみであり、セキュリティ上の新たなリスクはない。

### 7.2 スケーラビリティとパフォーマンス

- `/imp` の Step 7 の指示が詳細化されることで、Goals 達成確認にかかる時間がわずかに増加する可能性がある。ただし、これは Verification を適切に実行するための本来のコストであり、前回は省略されていたものが正しく実行されるだけである。

### 7.3 可観測性 (Observability)

- 該当なし。Markdown ファイルの修正のみである。

### 7.4 マイグレーションと後方互換性

- RFC テンプレートの変更は新規作成の RFC にのみ適用される。既存の承認済み RFC には影響しない。
- `/imp` コマンドの変更は、次回以降の実装コマンド実行時から適用される。進行中の実装に対する破壊的変更はない。
- RFC レビュー基準・実装レビュー基準の変更は、次回以降のレビュー実行時から適用される。
- ロールバックは各ファイルの変更を revert するだけで完了する。

## 8. テスト戦略 (Test Strategy)

- 対象がワークフロー定義ファイル（Markdown）のみであるため、自動テストの対象外である。
- 検証方法: 変更後の各ファイルの内容を Read で読み込み、以下の観点で確認する。
  - `adapters/claude/commands/imp.md`: Step 7 に「そのまま実行」の指示、「〜を実装済み」禁止規定、具体的なエビデンス例示が含まれること。
  - `templates/rfc/rfc-default.md`: Verification プレースホルダに「実装と同義の確認は不可」の制約が含まれること。
  - `prompts/criterias/rfc-review.md`: トートロジー的な確認方法を P0 として検出する項目が含まれること。
  - `prompts/criterias/impl-review.md`: 「〜を実装済み」がエビデンスとして不十分である旨の判定基準が含まれること。

## 9. 実装・リリース計画 (Implementation Plan)

- **フェーズ1（一括実装）**: 4ファイルの修正を1コミットで実施する。変更は相互に関連するが、いずれも Markdown の文言修正であるため、フェーズ分割は不要である。
- **成果物**: 修正済みの4つのワークフロー定義ファイル。
- **検証**: 各ファイルの変更内容を Goals テーブルの Verification に従って Read で読み込み、引用で確認する。
- **システム概要ドキュメントへの影響**: `docs/architecture.md`, `docs/domain-model.md`, `docs/api-overview.md` はいずれも存在しないため、影響はない。
