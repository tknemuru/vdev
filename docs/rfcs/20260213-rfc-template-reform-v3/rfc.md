# [RFC] RFCテンプレート改訂 v3: セクション構成の全面再編と記述形式ルールの導入

| 項目 | 内容 |
| :--- | :--- |
| **作成者 (Author)** | Claude (RFC Author) |
| **ステータス** | Draft (起草中) |
| **作成日** | 2026-02-13 |
| **タグ** | templates, workflow, process |
| **関連リンク** | RFC `20260212-rfc-template-reform-v2` |

## 1. 背景・動機 (Motivation)

現行のRFCテンプレートは前回の改革（v2）で外部仕様の追加やPhase禁止等を導入したが、依然としてAIが散文を書きすぎて人間の頭に入らない問題が残る。Goals表のVerification列とテスト戦略の役割が混線し、Goals表がプログラム寄りの記述になりがちである。また「実現方式」を示すセクションが欠落しており、要件と詳細設計の間の設計判断が埋もれている。本RFCではセクション構成の全面再編と記述形式ルールの導入により、これらの課題を一括して解決する。

## 2. 機能要件

### 達成すべき要件

| ID | 要件 |
|----|------|
| F1 | テンプレートのセクション構成を全11セクションに再編する |
| F2 | 旧「要約」セクションを廃止し、「背景・動機」を第1セクションとする |
| F3 | 「機能要件」セクションを新設し、要件テーブルとやらないこと箇条書きの2段構成とする |
| F4 | 「非機能要件」セクションを新設し、分類列を含む要件テーブルとやらないこと箇条書きの2段構成とする |
| F5 | 「実現方式」セクションを新設し、要件と実現方式の対応テーブルとする |
| F6 | 「代替案の検討」セクションを実現方式に対する代替案として再定義する |
| F7 | 旧Goals表のVerification列を廃止する |
| F8 | 「結合テスト仕様」セクションを新設し、検証コマンドで実施するテストを要件寄りで記述する |
| F9 | 「ドキュメント編集仕様」セクションを新設する |
| F10 | 「Task計画」セクションを新設し、旧「実装・リリース計画」から「完了条件」を廃止する |
| F11 | 「詳細設計」セクションの末尾サブセクションに「単体テスト仕様」テーブルを配置する |
| F12 | 全セクション共通の記述形式ルール3点を導入する（80文字上限・散文禁止・コード識別子禁止） |
| F13 | 記述形式ルールをテンプレートのHTMLコメント、RFC起草者ロール定義、RFC作成コマンドのDoDの3箇所に記載する |
| F14 | 検証コマンドの検証ソースを「結合テスト仕様」に変更する |
| F15 | 実装レビューコマンドのセクション番号参照を更新する |
| F16 | RFCレビューコマンドのセクション番号・名称参照を更新する |
| F17 | RFCレビュー基準のセクション構成対応を更新する |
| F18 | 実装開始コマンドの参照先セクション番号を更新する |

### やらないこと

- 要件IDの必須化（任意とする）
- 既存RFCの新テンプレートへの遡及適用

## 3. 非機能要件

### 達成すべき要件

| ID | 分類 | 要件 |
|----|------|------|
| N1 | 後方互換性 | 旧テンプレートで起草済みのRFCは旧フォーマットのまま運用可能であること |
| N2 | 後方互換性 | 検証・レビュー各コマンドが新セクション構成を参照しても旧RFCの運用に支障がないこと |

### やらないこと

- 旧テンプレートで起草済みRFCの自動マイグレーション

## 4. 実現方式

| 要件 | 実現方式 |
|------|----------|
| F1-F11 テンプレート再編 | テンプレート本体を全面書き換え。新11セクション構成のプレースホルダとHTMLコメントを配置 |
| F12 記述形式ルール導入 | 80文字上限・散文禁止・コード識別子禁止の3ルールを定義 |
| F13 3箇所への記載 | テンプレート冒頭HTMLコメント、RFC起草者ロール定義の文体ルール、RFC作成コマンドのDoDチェックリストにそれぞれ追記 |
| F7+F8 Verification廃止と結合テスト新設 | Goals表からVerification列を削除し、独立した結合テスト仕様セクションで検証内容を記述 |
| F14 検証コマンド更新 | 検証ソースの参照先を「Goals表のVerification列」から「結合テスト仕様」セクションに変更 |
| F15-F18 コマンド群のセクション番号更新 | 各コマンド定義内のセクション番号・名称参照を新構成に合わせて書き換え |
| N1-N2 後方互換性 | コマンドはセクション名称を併記し、番号だけでなく名称でも特定可能にする |

## 5. 代替案の検討

| 案 | 概要 | 採否 | 決定的理由 |
|----|------|------|------------|
| A: 全面再編 | 11セクション構成に一括で再編し、記述形式ルールを同時導入 | **採用** | セクション番号の変更が全コマンドに波及するため、一括実施が整合性維持に最適 |
| B: 段階的移行 | セクション追加・Verification廃止・記述形式ルールを3つのRFCに分割 | 却下 | 中間状態のテンプレートでセクション番号が都度変わり、コマンド参照の整合性維持が困難 |
| C: Verification列を残して結合テスト仕様を追加 | Goals表のVerification列は維持し、結合テスト仕様を併設 | 却下 | 2箇所に検証情報が分散し、混線問題が解消されない |

## 6. 外部仕様 (External Specification)

- RFC起草コマンド実行時に適用されるテンプレートが11セクション構成に変更される
- 旧テンプレートの「要約」セクションが廃止され、「背景・動機」が冒頭になる
- Goals表からVerification列がなくなり、検証内容は「結合テスト仕様」に記述する
- 「実現方式」セクションが新設され、要件と設計方針の対応関係を記述する
- 「ドキュメント編集仕様」セクションが新設される
- 「Task計画」セクション（旧「実装・リリース計画」）から「完了条件」サブセクションが廃止される
- 「詳細設計」に「単体テスト仕様」サブセクションが追加される
- 全セクションに80文字上限・散文禁止・コード識別子禁止の記述形式ルールが適用される
- 検証コマンドの検証ソースが「結合テスト仕様」に変更される

### RFC起草時の変更例

```markdown
# 旧テンプレートの構成（10セクション）
## 1. 要約 (Summary)              ← 廃止
## 2. 背景・動機 (Motivation)
## 3. 目的とスコープ (Goals)       ← 「機能要件」に再編
## 4. 外部仕様 (External Specification)
## 5. テスト戦略 (Test Strategy)   ← 「結合テスト仕様」に再編
## 6. 非機能要件 (Non-Functional Requirements)
## 7. 代替案の検討
## 8. 実装・リリース計画           ← 「Task計画」に再編
## 9. 前提条件・依存関係
## 10. 詳細設計 (Detailed Design)

# 新テンプレートの構成（11セクション）
## 1. 背景・動機 (Motivation)
## 2. 機能要件
## 3. 非機能要件
## 4. 実現方式
## 5. 代替案の検討
## 6. 外部仕様 (External Specification)
## 7. 結合テスト仕様
## 8. ドキュメント編集仕様
## 9. Task計画
## 10. 前提条件・依存関係
## 11. 詳細設計 (Detailed Design)
```

### 記述形式ルールの適用例

```markdown
# 80文字上限の違反例
- このテーブルセルには80文字を超える長い説明文が書かれており、読みにくいため分割が必要である。このような記述は禁止される。

# 80文字上限の準拠例
- テーブルセルには80文字を超える記述を禁止する
  - 超える場合はサブ項目に分割する

# コード識別子禁止の違反例（§1-5）
- `templates/rfc/rfc-default.md` を改修する

# コード識別子禁止の準拠例（§1-5）
- RFCテンプレート本体を改修する
```

## 7. 結合テスト仕様

| ID | 対応要件 | テスト内容 | 期待結果 |
|----|----------|------------|----------|
| T1 | F1-F11 | テンプレートファイルの全セクション見出しを抽出する | 11セクション構成が所定の順序・名称で存在する |
| T2 | F7 | テンプレートの機能要件セクションのテーブルヘッダを確認する | Verification列が存在しない |
| T3 | F8 | テンプレートの結合テスト仕様セクションのテーブルヘッダを確認する | ID/対応要件/テスト内容/期待結果の4列が存在する |
| T4 | F11 | テンプレートの詳細設計セクション末尾を確認する | 「単体テスト仕様」サブセクションが存在する |
| T5 | F12 | テンプレート冒頭のHTMLコメントを確認する | 80文字上限・散文禁止・コード識別子禁止の3ルールが記載されている |
| T6 | F13 | RFC起草者ロール定義の文体ルールを確認する | 記述形式ルール3点が記載されている |
| T7 | F13 | RFC作成コマンドのDoDチェックリストを確認する | 記述形式ルールに関するチェック項目が存在する |
| T8 | F14 | 検証コマンドの検証ソース参照を確認する | 「結合テスト仕様」への参照に変更されている |
| T9 | F15 | 実装レビューコマンドのセクション番号参照を確認する | 新セクション番号に更新されている |
| T10 | F16 | RFCレビューコマンドのセクション番号・名称参照を確認する | 新セクション番号・名称に更新されている |
| T11 | F17 | RFCレビュー基準のセクション参照を確認する | 新セクション構成に対応した参照に更新されている |
| T12 | F18 | 実装開始コマンドのセクション番号参照を確認する | 新セクション番号に更新されている |
| T13 | F12 | テンプレートの全テーブルセルを目視確認する | プレースホルダが80文字以内に収まっている |

## 8. ドキュメント編集仕様

| 対象ファイル | 操作 | 変更内容 |
|-------------|------|----------|
| テンプレート本体 | 更新 | 全面改訂: 11セクション構成への再編、記述形式ルールのHTMLコメント追記 |
| RFC起草者ロール定義 | 更新 | 文体ルールに記述形式ルール3点を追記 |
| RFC作成コマンド | 更新 | DoDチェックリストを新セクション構成に合わせて更新、記述形式ルール項目追加 |
| 検証コマンド | 更新 | 検証ソースを「結合テスト仕様」に変更、セクション番号更新 |
| 実装レビューコマンド | 更新 | セクション番号参照の更新 |
| RFCレビューコマンド | 更新 | セクション番号・名称参照の更新 |
| RFCレビュー基準 | 更新 | セクション構成対応の更新 |
| 実装開始コマンド | 更新 | 参照先セクション番号の更新 |

システム概要ドキュメント（`docs/architecture.md`, `docs/domain-model.md`, `docs/api-overview.md`）は本リポジトリに存在しないため、更新対象はない。

## 9. Task計画

| # | 種別 | 作業内容 | 依存 |
|---|------|----------|------|
| 1 | コード | テンプレート本体の全面改訂（11セクション構成・記述形式ルールHTMLコメント） | - |
| 2 | コード | RFC起草者ロール定義に記述形式ルール3点を追記 | - |
| 3 | コード | RFC作成コマンドのDoDチェックリストを新セクション構成に合わせて更新 | - |
| 4 | コード | 検証コマンドの検証ソース参照を「結合テスト仕様」に変更 | - |
| 5 | コード | 実装レビューコマンドのセクション番号参照を更新 | - |
| 6 | コード | RFCレビューコマンドのセクション番号・名称参照を更新 | - |
| 7 | コード | RFCレビュー基準のセクション構成対応を更新 | - |
| 8 | コード | 実装開始コマンドの参照先セクション番号を更新 | - |
| 9 | コード | 結合テスト仕様に基づく全テスト実行 | #1-#8 |

### ロールバック基準と手順

- **基準**: 変更後のテンプレートやコマンド定義が意図しない動作を引き起こす場合
- **手順**: 全変更がMarkdownファイルのテキスト修正であるため、`git revert` で完了する

## 10. 前提条件・依存関係

| 種別 | 内容 |
|------|------|
| 前提RFC | RFC `20260212-rfc-template-reform-v2` が承認・マージ済みであること |
| 前提RFC | RFC `20260212-verification-gate` が承認・マージ済みであること |
| ファイル依存 | 変更対象は全てMarkdownファイルであり、外部ツール・ライブラリへの依存はない |

## 11. 詳細設計 (Detailed Design)

### 11.1 テンプレート全文: テンプレート本体

変更後のテンプレート全体構成（全11セクション）を以下に示す。

```markdown
# [RFC] {提案タイトル}

| 項目 | 内容 |
| :--- | :--- |
| **作成者 (Author)** | {作成者名} |
| **ステータス** | Draft (起草中) |
| **作成日** | YYYY-MM-DD |
| **タグ** | {タグ} |
| **関連リンク** | {関連リンク} |

<!-- 記述形式ルール（全セクション共通）:
1. 80文字上限: 1箇条書き項目・1テーブルセルは80文字以内
   80文字に収まらない場合はサブ項目分割またはテーブル行分割
2. 散文禁止（例外あり）:
   §1のみ散文許可（5文以内）
   §11のコードブロック間補足は2文以内の散文許可
   他セクションは散文禁止でテーブルまたは箇条書きのみ
3. §1-5 コード識別子禁止:
   バッククォートで囲まれたコード識別子の使用を禁止
   （ファイル名、関数名、変数名、パス、コマンド）
   機能名称またはドメイン用語で記述すること
-->

## 1. 背景・動機 (Motivation)

<!-- 散文で記述。ただし5文以内。 -->

{なぜこの変更が必要か、現状の課題は何か}

## 2. 機能要件

### 達成すべき要件

<!-- コード識別子禁止。機能名称またはドメイン用語で記述。 -->

| ID | 要件 |
|----|------|
| {ID} | {達成すべき要件} |

### やらないこと

- {あえてやらないこと、スコープ外のこと}

## 3. 非機能要件

### 達成すべき要件

| ID | 分類 | 要件 |
|----|------|------|
| {ID} | {分類} | {達成すべき要件} |

### やらないこと

- {あえてやらないこと、スコープ外のこと}

## 4. 実現方式

<!-- 機能要件・非機能要件をどう実現するかの高レベル方針。 -->

| 要件 | 実現方式 |
|------|----------|
| {対応する要件} | {高レベルの実現方針} |

## 5. 代替案の検討

<!-- §4の実現方式に対する代替案。最低2案を比較。 -->

| 案 | 概要 | 採否 | 決定的理由 |
|----|------|------|------------|
| A: {名称} | {1行要約} | **採用** | {決め手} |
| B: {名称} | {1行要約} | 却下 | {決め手} |

## 6. 外部仕様 (External Specification)

<!-- ユーザ・運用者視点の振る舞い。箇条書き＋コード例。 -->

- {ユーザから見た変更点}

## 7. 結合テスト仕様

<!-- /vfyで実施するテスト。要件寄りで記述。 -->

| ID | 対応要件 | テスト内容 | 期待結果 |
|----|----------|------------|----------|
| {ID} | {要件ID} | {テスト内容} | {期待結果} |

## 8. ドキュメント編集仕様

<!-- システム概要ドキュメント等の作成・更新・削除。 -->

| 対象ファイル | 操作 | 変更内容 |
|-------------|------|----------|
| {ファイル} | 作成 / 更新 / 削除 | {変更内容} |

## 9. Task計画

<!-- Phase/フェーズによる作業分割を禁止する。 -->
<!-- 全作業項目は単一のPRで完遂すること。 -->

| # | 種別 | 作業内容 | 依存 |
|---|------|----------|------|
| 1 | コード | {作業内容} | - |

### ロールバック基準と手順

- {ロールバック基準}
- {ロールバック手順}

## 10. 前提条件・依存関係

| 種別 | 内容 |
|------|------|
| {種別} | {内容} |

## 11. 詳細設計 (Detailed Design)

<!-- 箇条書き＋コード例。 -->
<!-- コードブロック間補足は2文以内の散文許可。 -->

- {設計の詳細}

### 単体テスト仕様

| テスト対象 | 検証観点 |
|-----------|----------|
| {対象} | {観点} |
```

### 11.2 RFC起草者ロール定義への追記

文体ルールセクションに以下の記述形式ルールを追記する。

```markdown
### 記述形式ルール
- 1箇条書き項目・1テーブルセルは80文字以内。超える場合はサブ項目分割またはテーブル行分割。
- §1（背景・動機）のみ散文許可（5文以内）。§11のコードブロック間補足は2文以内の散文許可。他セクションはテーブルまたは箇条書きのみ。
- §1〜§5ではバッククォートで囲まれたコード識別子（ファイル名、関数名、変数名、パス、コマンド）を禁止。機能名称またはドメイン用語で記述する。
```

### 11.3 RFC作成コマンドのDoD更新

現行のDoDチェックリストを新セクション構成に合わせて全面更新する。

```markdown
- [ ] 背景・動機が5文以内の散文で記述されていること
- [ ] 機能要件が要件テーブルで記述されていること
- [ ] 非機能要件が分類付き要件テーブルで記述されていること
- [ ] 実現方式が要件と方針の対応テーブルで記述されていること
- [ ] 代替案が最低2案比較されていること
- [ ] 外部仕様がユーザ視点で記述されていること
- [ ] 結合テスト仕様がテーブル形式で記述されていること
- [ ] ドキュメント編集仕様にシステム概要ドキュメントへの影響が判断されていること
- [ ] Task計画がPhase/フェーズで分割されていないこと
- [ ] Task計画の全作業項目が単一PRで完遂可能な規模であること
- [ ] 詳細設計に単体テスト仕様が含まれていること
- [ ] 記述形式ルールに違反していないこと（80文字上限・散文禁止・コード識別子禁止）
```

### 11.4 検証コマンドの変更

Step 3 の検証ソース抽出箇所を以下のように変更する。

現行:
- Goals テーブルから全 Goal の Verification を抽出する
- テスト戦略セクション（セクション5）から全テスト項目を抽出する

変更後:
- 結合テスト仕様（セクション7）から全テスト項目を抽出する

Step 4 の対象も結合テスト仕様に基づくテスト充足確認に変更する。

Step 5 の Verification 実行を、結合テスト仕様の各テスト項目の実行に変更する。

### 11.5 実装レビューコマンドの変更

`/rimp` 内でRFCのセクション参照がある箇所のセクション番号を新構成に合わせて更新する。具体的には、RFCとの整合性確認時のセクション参照を新番号体系に更新する。

### 11.6 RFCレビューコマンドの変更

`/rrfc` 内でRFCのセクション参照がある箇所のセクション番号・名称を新構成に合わせて更新する。

### 11.7 RFCレビュー基準の変更

`prompts/criterias/rfc-review.md` の Approach Reviewer セクションの参照を更新する。

現行:
- Goals / Non-Goals の線引きに論理的根拠があるか
- 各 Goal に対して具体的な達成確認方法（Verification）が定義されているか

変更後:
- 機能要件 / やらないことの線引きに論理的根拠があるか
- 結合テスト仕様の各テストが要件に対応しているか
- Verification に関するトートロジー検出ルールを結合テスト仕様向けに再定義する

### 11.8 実装開始コマンドの変更

`/imp` の Step 4 のセクション番号参照を更新する。

現行:
- RFC の詳細設計（セクション10）から、変更・新規作成が必要なファイルを特定する

変更後:
- RFC の詳細設計（セクション11）から、変更・新規作成が必要なファイルを特定する

### 単体テスト仕様

| テスト対象 | 検証観点 |
|-----------|----------|
| テンプレート本体 | 旧セクション名（要約、Goals、テスト戦略、実装・リリース計画）が残存しないこと |
| テンプレート本体 | HTMLコメントに記述形式ルール3点が全て含まれること |
| RFC起草者ロール定義 | 記述形式ルール3点が文体ルールに含まれること |
| RFC作成コマンド | DoDチェック項目が新セクション構成に対応していること |
| 検証コマンド | 「結合テスト仕様」への参照が存在し旧参照が残存しないこと |
| RFCレビュー基準 | Verification列への参照が廃止され結合テスト仕様への参照に変更されていること |
