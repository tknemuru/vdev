# [RFC] RFCテンプレートのフォーマット改善

| 項目 | 内容 |
| :--- | :--- |
| **作成者 (Author)** | AI (Claude) |
| **ステータス** | Accepted (承認済) |
| **作成日** | 2026-02-10 |
| **タグ** | workflow, rfc-template |
| **関連リンク** | `templates/rfc/rfc-default.md`, `adapters/claude/commands/imp.md` |

## 1. 要約 (Summary)

- RFCテンプレート（`templates/rfc/rfc-default.md`）のセクション順序を、人間レビュアーの確認優先度に合わせて再編する。詳細設計・前提条件など人間がほぼ確認しないセクションを末尾へ移動し、テスト戦略・横断的関心事・代替案をレビュアーの目に入りやすい位置へ引き上げる。
- 代替案セクションの散文形式をテーブル形式に変更し、比較の一覧性を向上させる。
- 横断的関心事セクションに「該当するサブセクションのみ記載せよ」「各項目は1〜3行で簡潔に」という指示をHTMLコメントで追加し、不要なサブセクションが残るノイズを排除する。
- セクション番号変更に伴い、`adapters/claude/commands/imp.md` の参照を更新する。

## 2. 背景・動機 (Motivation)

- 現行テンプレートのセクション順序は論理的な構造（背景→前提→設計→代替案→横断的関心事→テスト→実装計画）に従っているが、人間レビュアーの確認優先度と一致していない。人間レビュアーが重視するのは「要約・背景・目的」に続いて「テスト戦略・横断的関心事・代替案」であり、「詳細設計」はAI実装者向けの仕様として人間はほぼ確認しない。「前提条件・依存関係」も事前議論で自明なことが多い。これらが中盤に位置することで、レビュアーが本来注目すべきセクションまでのスクロール距離が不要に長くなっている。
- 代替案セクションの「概要・長所・短所」の散文形式は冗長である。各案のサブセクション見出し、箇条書き項目名、選定理由セクションが分散しており、案の比較に必要な情報を一覧するには全体を読み通す必要がある。テーブル形式であれば1行1案で比較でき、採否と決定的理由が一目で把握できる。
- 横断的関心事セクションは4つのサブセクション（セキュリティ、スケーラビリティ、可観測性、マイグレーション）がプレースホルダとして残っている。該当しない場合でも「該当なし」と書くか空のまま残す運用になっており、レビュー時のノイズとなっている。既存RFCの実例（`20260210-info-arch-3layer-reform/rfc.md`）でも、Markdown ファイルの修正のみの提案に対して4サブセクションすべてが記載されており、実質的な内容は「該当なし」であった。
- 放置した場合、新規RFC起草のたびに同じ構造的非効率が繰り返される。テンプレートは vdev リポジトリから csync で全リポジトリに同期されるため、改善効果は全プロジェクトに波及する。

## 3. 目的とスコープ (Goals & Non-Goals)

### 目的 (Goals)

| # | Goal | 達成確認方法 (Verification) |
|---|------|-----------------------------|
| G1 | テンプレートのセクション順序を再編し、詳細設計がセクション9（末尾）、前提条件がセクション8に配置されること | 変更後の `templates/rfc/rfc-default.md` を Read で読み込み、セクション番号と見出しの順序が要件通り（1.要約, 2.背景, 3.目的, 4.テスト戦略, 5.横断的関心事, 6.代替案, 7.実装計画, 8.前提条件, 9.詳細設計）であることを確認する |
| G2 | 代替案セクションがテーブル形式に変更されていること | 変更後のテンプレートを Read で読み込み、代替案セクションにMarkdownテーブル（`| 案 | 概要 | 採否 | 決定的理由 |` ヘッダ）が存在し、旧来の散文形式（案A/案Bサブセクション）が除去されていることを確認する |
| G3 | 横断的関心事セクションに簡潔化の指示がHTMLコメントで追加されていること | 変更後のテンプレートを Read で読み込み、横断的関心事セクションに「該当するサブセクションのみ記載」「該当しないものは削除」「各項目は1〜3行で簡潔に」という指示のHTMLコメントが存在することを確認する |
| G4 | `imp.md` のセクション番号参照が新番号（セクション9）に更新されていること | 変更後の `adapters/claude/commands/imp.md` を Read で読み込み、「RFC の詳細設計（セクション9）」という記載が存在し、旧番号（セクション5）への参照が存在しないことを確認する |

### やらないこと (Non-Goals)

- テンプレートの新規セクション追加や既存セクション内容の変更は行わない。本RFCはセクション順序の再編とフォーマット変更のみを対象とする。
- テンプレート以外のRFCファイル（既存の起草済みRFC）のフォーマット変更は行わない。
- `/rfc` コマンド定義の変更は行わない。テンプレート構造はコマンドがコピーした後の起草時に参照されるため、コマンド側の修正は不要である。

## 4. テスト戦略 (Test Strategy)

- 対象がMarkdownテンプレートファイルと Markdownコマンド定義ファイルのみであるため、自動テストの対象外である。
- 検証方法: 変更後の各ファイルの内容を Read で読み込み、Goals テーブルの Verification に記載した手順で確認する。
  - `templates/rfc/rfc-default.md`: セクション順序、代替案テーブル形式、横断的関心事のHTMLコメントを確認する。
  - `adapters/claude/commands/imp.md`: 「セクション9」参照を確認する。

## 5. 横断的関心事 (Cross-Cutting Concerns)

<!-- 該当するサブセクションのみ記載せよ。該当しないものは削除すること。 -->
<!-- 各項目は1〜3行で簡潔に。詳細な設計はセクション9（詳細設計）に記載する。 -->

### 5.1 マイグレーションと後方互換性

- テンプレートの変更は新規RFC起草時にのみ影響する。既存の起草済みRFCは旧フォーマットのまま残り、後方互換性の問題は発生しない。
- csync による全リポジトリ同期後、次回の `/rfc` 実行から新テンプレートが適用される。
- `imp.md` のセクション番号参照は、新テンプレートで起草されたRFCに対してのみ有効である。旧テンプレートで起草された既存RFCを `/imp` で実装する場合、セクション番号が異なるが、`/imp` の Step 4 は「RFC の詳細設計」という文言で内容を特定しており、セクション番号はヒントに過ぎないため、実運用上の問題は軽微である。

## 6. 代替案の検討 (Alternatives Considered)

<!-- 最低2案を比較し、選定理由を明示する。各案の説明は1行に収めること。 -->

| 案 | 概要 | 採否 | 決定的理由 |
|---|---|---|---|
| A: セクション順序再編+フォーマット改善 | 人間レビュアー優先度に沿った順序再編、代替案テーブル化、横断的関心事簡潔化を一括実施 | **採用** | レビュアー体験と記述効率を同時に改善でき、変更が相互に関連するため一括実施が整合的 |
| B: セクション順序のみ変更 | 順序再編のみ行い、代替案・横断的関心事のフォーマットは現行維持 | 却下 | 順序変更だけではフォーマットの冗長性が残り、改善効果が限定的。別RFCで追加改善する二度手間が発生する |
| C: 詳細設計を別ファイルに分離 | 詳細設計セクションをRFC本体から `design.md` 等に分離し、本体をレビュー用に簡潔化 | 却下 | テンプレート構造の大幅変更となり、`/rfc` コマンドや既存ワークフローへの影響が大きい。セクション末尾移動で十分な効果が得られる |

## 7. 実装・リリース計画 (Implementation Plan)

- 変更対象ファイルと作業項目:

| # | ファイル | 作業内容 |
|---|---------|---------|
| 1 | `templates/rfc/rfc-default.md` | セクション順序の再編（4→8, 5→9, 6→6, 7→5, 8→4, 9→7）、代替案セクションのテーブル化、横断的関心事のHTMLコメント追加 |
| 2 | `adapters/claude/commands/imp.md` | Step 4 の「セクション5」を「セクション9」に更新 |

- 作業項目1と2は独立しているが、相互に関連する Markdown の文言修正であるため、1コミットで実施する。
- ロールバック: 各ファイルの変更を git revert するだけで完了する。
- システム概要ドキュメントへの影響: `docs/architecture.md`, `docs/domain-model.md`, `docs/api-overview.md` は vdev リポジトリに存在しないため、更新対象はない。

## 8. 前提条件・依存関係 (Prerequisites & Dependencies)

- 変更対象は vdev リポジトリ内の Markdown ファイル2つのみである。外部ツールやライブラリへの依存はない。
- csync による全リポジトリ同期は既存の仕組みをそのまま使用する。

## 9. 詳細設計 (Detailed Design)

### 9.1 テンプレート変更: セクション順序の再編

**対象ファイル**: `templates/rfc/rfc-default.md`

現行のセクション順序と変更後の対応:

| 現行 | 変更後 | 移動方向 |
|------|--------|---------|
| 1. 要約 | 1. 要約 | 据え置き |
| 2. 背景・動機 | 2. 背景・動機 | 据え置き |
| 3. 目的とスコープ | 3. 目的とスコープ | 据え置き |
| 4. 前提条件・依存関係 | **8. 前提条件・依存関係** | 後方移動 |
| 5. 詳細設計 | **9. 詳細設計** | 末尾固定 |
| 6. 代替案の検討 | **6. 代替案の検討** | 据え置き |
| 7. 横断的関心事 | **5. 横断的関心事** | 前方移動 |
| 8. テスト戦略 | **4. テスト戦略** | 前方移動 |
| 9. 実装・リリース計画 | **7. 実装・リリース計画** | 据え置き相当 |

変更後のテンプレート全体の構成:

```markdown
## 1. 要約 (Summary)
## 2. 背景・動機 (Motivation)
## 3. 目的とスコープ (Goals & Non-Goals)
## 4. テスト戦略 (Test Strategy)
## 5. 横断的関心事 (Cross-Cutting Concerns)
## 6. 代替案の検討 (Alternatives Considered)
## 7. 実装・リリース計画 (Implementation Plan)
## 8. 前提条件・依存関係 (Prerequisites & Dependencies)
## 9. 詳細設計 (Detailed Design)
```

設計根拠:
- セクション1〜3は提案の核心であり、すべてのレビュアーが確認するため先頭に固定する。
- セクション4〜6は人間レビュアーが設計判断の妥当性を評価するセクションであり、中盤に配置する。テスト戦略を最も前に置くのは、「どう検証するか」が設計の妥当性判断に直結するためである。
- セクション7は実装計画であり、承認判断の後に確認される情報である。
- セクション8〜9は人間レビュアーがほぼ確認しない情報（事前議論で自明な前提条件、AI実装者向けの詳細仕様）であり、末尾に配置する。

### 9.2 テンプレート変更: 代替案セクションのテーブル化

**変更箇所**: 代替案セクション（変更後セクション6）の本文を置き換える。

変更前:
```markdown
## 6. 代替案の検討 (Alternatives Considered)

<!-- 最低2案を提示し、選定理由を明示する -->

### 案A: {案の名称}

- **概要**: {アプローチの説明}
- **長所**: {メリット}
- **短所**: {デメリット}

### 案B: {案の名称}

- **概要**: {アプローチの説明}
- **長所**: {メリット}
- **短所**: {デメリット}

### 選定理由

- {なぜ採用案を選んだか、決定的な差異は何か}
```

変更後:
```markdown
## 6. 代替案の検討 (Alternatives Considered)

<!-- 最低2案を比較し、選定理由を明示する。各案の説明は1行に収めること。 -->

| 案 | 概要 | 採否 | 決定的理由 |
|---|---|---|---|
| A: {名称} | {アプローチの1行要約} | **採用** | {選んだ決め手} |
| B: {名称} | {アプローチの1行要約} | 却下 | {却下の決め手} |
```

設計根拠:
- テーブル形式は各案の比較情報を横並びで表示し、一覧性を大幅に向上させる。
- 「採否」列と「決定的理由」列により、選定理由が各案に直接紐づく。旧形式では選定理由が別セクションに分離されており、案と理由の対応を読み取るために往復が必要であった。
- 「各案の説明は1行に収めること」の制約は、過剰に詳細な代替案説明を防止する。詳細な比較が必要な場合はセクション9（詳細設計）に記載できる。

### 9.3 テンプレート変更: 横断的関心事の簡潔化

**変更箇所**: 横断的関心事セクション（変更後セクション5）のHTMLコメントを追加する。

変更前:
```markdown
## 7. 横断的関心事 (Cross-Cutting Concerns)

### 7.1 セキュリティとプライバシー
...
```

変更後:
```markdown
## 5. 横断的関心事 (Cross-Cutting Concerns)

<!-- 該当するサブセクションのみ記載せよ。該当しないものは削除すること。 -->
<!-- 各項目は1〜3行で簡潔に。詳細な設計はセクション9（詳細設計）に記載する。 -->

### 5.1 セキュリティとプライバシー
...
```

設計根拠:
- HTMLコメントはレンダリング時に非表示となるため、起草完了後のRFCドキュメントの見た目に影響しない。
- 「該当しないものは削除すること」の明示的指示により、「該当なし」の記載やプレースホルダの残存を防止する。
- 「詳細な設計はセクション9に記載する」の指示により、横断的関心事セクションが設計詳細で膨張することを防止する。

### 9.4 参照更新: imp.md のセクション番号

**対象ファイル**: `adapters/claude/commands/imp.md`

**変更箇所**: Step 4 の1行

変更前:
```
- RFC の詳細設計（セクション5）から、変更・新規作成が必要なファイルを特定する
```

変更後:
```
- RFC の詳細設計（セクション9）から、変更・新規作成が必要なファイルを特定する
```
