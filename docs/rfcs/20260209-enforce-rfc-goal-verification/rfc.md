# [RFC] RFC Goals 達成確認の強制化

| 項目 | 内容 |
| :--- | :--- |
| **作成者 (Author)** | AI (Claude) |
| **ステータス** | Draft (起草中) |
| **作成日** | 2026-02-09 |
| **タグ** | workflow, quality-assurance |
| **関連リンク** | なし |

## 1. 要約 (Summary)

- RFC の「目的 (Goals)」に対する達成確認方法が曖昧なまま設計・実装が進行し、Goals の達成有無を判断できない問題を解消する。
- RFC テンプレートの Goals セクションをテーブル形式に変更し、各 Goal に一意IDと「達成確認方法 (Verification)」列を必須化する。
- RFC レビュー基準に Goals の検証可能性チェックを追加し、曖昧な確認方法を設計段階で排除する。
- `/imp` コマンドに Goals 達成確認ステップを追加し、実装完了時にエビデンスを自動収集して PR 本文に記載する。
- 実装レビュー基準に Goals 達成エビデンスの確認項目を追加し、エビデンス不足を P0 として検出する。

## 2. 背景・動機 (Motivation)

- 現行の RFC ワークフローでは、Goals に「達成確認方法」の記述が求められていない。そのため、Goals の達成を客観的に判断する情報がないまま実装が完了し、PR がレビューを通過する問題が発生している。
- 実例として、実装 PR に対する人間レビューで「RFC の目的 (Goals) を達成できたのかが把握できない。達成を示すエビデンスを PR に貼り付けて。」という指摘があった。AI が自ら Goal を設定しておきながら、達成確認方法を持たず「どうやって実測しましょうか？」と聞き返す状態は、ワークフローの設計欠陥である。
- 問題は以下の2段階で発生している:
  1. **設計段階**: Goals の達成確認方法が曖昧なまま RFC が作成・レビューを通過する。
  2. **実装段階**: Goals の達成確認を行わないまま実装が完了し、AI による PR レビューを通過する。
- 放置した場合、Goals が形骸化し「書いただけで検証されない目標」となる。RFC-driven 開発の品質保証としての機能が損なわれる。

## 3. 目的とスコープ (Goals & Non-Goals)

### 目的 (Goals)

| # | Goal | 達成確認方法 (Verification) |
|---|------|-----------------------------|
| G1 | RFC テンプレートの Goals セクションをテーブル形式に変更し、各 Goal に一意IDと達成確認方法列を必須化する | `templates/rfc/rfc-default.md` の Goals セクションがテーブル形式であり、`#`, `Goal`, `達成確認方法 (Verification)` の3列を持つことを目視確認する |
| G2 | RFC レビュー基準に Goals の検証可能性チェックを追加する | `prompts/criterias/rfc-review.md` の Approach Reviewer セクションに、各 Goal の達成確認方法が実行可能な手順として記述されているかを検証する項目が存在することを目視確認する |
| G3 | `/imp` コマンドに Goals 達成確認ステップを追加し、結果を PR 本文に含める | `adapters/claude/commands/imp.md` に Goals 達成確認ステップが存在し、達成確認結果テーブルの作成と PR 本文への記載が指示されていることを目視確認する |
| G4 | 実装レビュー基準に Goals 達成エビデンス確認を追加する | `prompts/criterias/impl-review.md` の Approach Reviewer セクションに、Goals 達成エビデンスが PR に記載されているかを検証する項目が存在することを目視確認する |

### やらないこと (Non-Goals)

- 既存の承認済み RFC に対する遡及的な Goals テーブル化は行わない。
- Goals の達成確認を自動化するツール・スクリプトの開発は行わない（確認手順の記述と実行は AI エージェントが担う）。
- RFC テンプレートの Goals 以外のセクション構造の見直しは行わない。

## 4. 前提条件・依存関係 (Prerequisites & Dependencies)

- 本 RFC は vdev リポジトリ内のワークフロー定義ファイル（Markdown）のみを変更対象とする。外部ツールやライブラリへの依存はない。
- 変更対象ファイルが現行のデフォルトブランチに存在すること。

## 5. 詳細設計 (Detailed Design)

### 5.1 変更対象ファイル一覧

| # | ファイル | 変更概要 |
|---|---------|---------|
| 1 | `templates/rfc/rfc-default.md` | Goals セクションをテーブル形式に変更 |
| 2 | `prompts/criterias/rfc-review.md` | Approach Reviewer に検証可能性チェックを追加 |
| 3 | `adapters/claude/commands/imp.md` | Goals 達成確認ステップと PR 本文テンプレート変更 |
| 4 | `prompts/criterias/impl-review.md` | Approach Reviewer にエビデンス確認を追加 |

### 5.2 変更1: RFC テンプレートの Goals テーブル化

**対象ファイル**: `templates/rfc/rfc-default.md`

**変更箇所**: セクション3「目的とスコープ (Goals & Non-Goals)」の「目的 (Goals)」部分

現状:
```markdown
### 目的 (Goals)

- {達成すべき具体的な目標}
- {定量的な成功指標があれば記述（例: レスポンスタイム xxx ms以下）}
```

変更後:
```markdown
### 目的 (Goals)

| # | Goal | 達成確認方法 (Verification) |
|---|------|-----------------------------|
| G1 | {達成すべき具体的な目標} | {どのような手段で達成を確認するか。計測コマンド、テストケース、目視確認手順など具体的に記述} |
| G2 | ... | ... |
```

変更のポイント:
- 各 Goal に一意ID（G1, G2, ...）を付与し、実装・レビュー時の参照を容易にする。
- 「達成確認方法 (Verification)」列を設け、Goal 設定時に確認手段の明示を強制する。
- 箇条書きからテーブル形式に変更することで、Goal と確認方法の対応関係を視覚的に明確にする。

### 5.3 変更2: RFC レビュー基準の追加

**対象ファイル**: `prompts/criterias/rfc-review.md`

**変更箇所**: Approach Reviewer セクションの末尾に以下を追加する。

追加する検証項目:
```markdown
- 各 Goal に対して具体的な達成確認方法（Verification）が定義されているか。「検討する」「評価する」等の曖昧な記述ではなく、実行可能な確認手順（計測コマンド、テストケース、目視確認手順等）が示されていること。
```

この検証項目により、RFC レビュー段階で曖昧な確認方法を排除する。Approach Reviewer は設計意図と要件の整合性を担当するため、Goals の検証可能性チェックはこのレビュアーの責務に合致する。

### 5.4 変更3: `/imp` コマンドへの Goals 達成確認ステップ追加

**対象ファイル**: `adapters/claude/commands/imp.md`

#### 5.4.1 新ステップの追加位置

現行の Step 6（テスト実行）と Step 7（コミット & プッシュ & PR 作成）の間に、新しい Step 7「Goals 達成確認」を挿入する。現行の Step 7 は Step 8 に繰り下がる。

#### 5.4.2 新 Step 7: Goals 達成確認

以下の内容を追加する:

```markdown
### Step 7: Goals 達成確認

1. Step 3 で読み込んだ RFC の Goals テーブルから、各 Goal の `#`、`Goal`、`達成確認方法 (Verification)` を抽出する。
2. 各 Goal の Verification を順に実行する（コマンド実行、テスト結果確認、ファイル内容の目視確認など）。
3. 達成確認結果を以下のテーブル形式でまとめる:

| # | Goal | Verification | 結果 | エビデンス |
|---|------|-------------|------|-----------|
| G1 | {Goal内容} | {確認方法} | OK / NG | {確認結果の詳細。コマンド出力、確認した内容等} |

4. NG の Goal がある場合はユーザに報告し、続行するか確認する。
5. 達成確認結果は Step 8 の PR 作成時に本文へ含める。
```

#### 5.4.3 Step 8 (旧 Step 7): PR 本文テンプレートの変更

PR 作成時の `--body` テンプレートに Goals 達成確認セクションを追加する:

```markdown
## Summary

RFC に基づく実装。

- **RFC**: `docs/rfcs/<slug>/rfc.md`
- **Branch**: `feature/<slug>`

## Goals 達成確認

| # | Goal | Verification | 結果 | エビデンス |
|---|------|-------------|------|-----------|
| G1 | ... | ... | OK | ... |

---
このPRはAIレビュー完了後に Ready 状態になります。
```

### 5.5 変更4: 実装レビュー基準の追加

**対象ファイル**: `prompts/criterias/impl-review.md`

**変更箇所**: Approach Reviewer セクションの末尾に以下を追加する。

追加する検証項目:
```markdown
- RFC の各 Goal に対する達成確認結果（エビデンス）がPRに記載されているか。エビデンスが不足または不明確な場合は P0 として指摘すること。
```

P0 とする理由: Goals の達成確認は RFC-driven 開発の根幹であり、エビデンスの欠落は「仕様漏れ」に該当する。P1 以下では対応が任意となり、強制力が不足する。

## 6. 代替案の検討 (Alternatives Considered)

### 案A: 4箇所同時変更による一貫性確保（採用案）

- **概要**: RFC テンプレート、RFC レビュー基準、`/imp` コマンド、実装レビュー基準の4箇所を同時に変更し、Goals の設計時定義 → 設計レビュー → 実装時確認 → 実装レビュー の全段階で検証可能性を担保する。
- **長所**: ワークフロー全体で一貫した強制力を持つ。1箇所だけ変更した場合に起こりうる「テンプレートには書いたがレビューで検証されない」等の抜け穴を防ぐ。
- **短所**: 変更箇所が4ファイルに分散するため、実装・レビューの対象が多い。

### 案B: RFC テンプレートのみ変更

- **概要**: RFC テンプレートに Verification 列を追加するのみとし、レビュー基準や `/imp` コマンドは変更しない。
- **長所**: 変更範囲が最小限で、影響が小さい。
- **短所**: テンプレートに列を追加しても、レビューで検証されず、実装時にも確認されないため、形骸化するリスクが高い。これは現状の問題（Goals が検証されない）の根本原因と同じ構造であり、解決にならない。

### 選定理由

- 案A を採用する。本 RFC が解決すべき問題は「Goals の達成確認が強制されない」ことであり、ワークフローの複数段階で強制力を持たせなければ根本解決にならない。案B はテンプレートの構造改善にとどまり、実効性が不十分である。4ファイルの変更はいずれもMarkdown の軽微な編集であり、実装コストは低い。

## 7. 横断的関心事 (Cross-Cutting Concerns)

### 7.1 セキュリティとプライバシー

- 対象はワークフロー定義ファイル（Markdown）のみであり、セキュリティ上の新たなリスクはない。

### 7.2 スケーラビリティとパフォーマンス

- `/imp` コマンドに Goals 達成確認ステップが追加されることで、実装完了までの所要時間がわずかに増加する。ただし、これは本来実施すべき品質確認作業であり、パフォーマンス上の問題とはならない。

### 7.3 可観測性 (Observability)

- 該当なし。Markdown ファイルの修正のみである。

### 7.4 マイグレーションと後方互換性

- RFC テンプレートの変更は新規作成の RFC にのみ適用される。既存の承認済み RFC の Goals セクション形式は変更しない。
- `/imp` コマンドの Goals 達成確認ステップは、RFC に Goals テーブルが存在する場合にのみ実行される。旧形式（箇条書き）の RFC に対して `/imp` を実行した場合でも、Goals テーブルが見つからないだけであり、エラーにはならない。
- ロールバックは各ファイルの変更を revert するだけで完了する。

## 8. テスト戦略 (Test Strategy)

- 対象がワークフロー定義ファイル（Markdown）のみであるため、自動テストの対象外である。
- 検証方法: 変更後の各ファイルの内容を目視確認し、以下の観点で検証する。
  - `templates/rfc/rfc-default.md`: Goals セクションがテーブル形式であり、`#`, `Goal`, `達成確認方法 (Verification)` の3列構成であること。
  - `prompts/criterias/rfc-review.md`: Approach Reviewer に Goals の検証可能性チェック項目が追加されていること。
  - `adapters/claude/commands/imp.md`: Step 6 と旧 Step 7 の間に Goals 達成確認ステップが存在し、PR 本文テンプレートに Goals 達成確認セクションが含まれていること。
  - `prompts/criterias/impl-review.md`: Approach Reviewer に Goals 達成エビデンス確認項目が追加されていること。

## 9. 実装・リリース計画 (Implementation Plan)

- **フェーズ1（一括実装）**: 4ファイルの修正を1コミットで実施する。変更は相互に関連するが、いずれも Markdown の軽微な編集であるため、フェーズ分割は不要である。
- **成果物**: 修正済みの4つのワークフロー定義ファイル。
- **検証**: 各ファイルの変更内容を Goals テーブルの Verification に従って目視確認する。
- **システム概要ドキュメントへの影響**: `docs/architecture.md`, `docs/domain-model.md`, `docs/api-overview.md` はいずれも存在しないため、影響はない。
