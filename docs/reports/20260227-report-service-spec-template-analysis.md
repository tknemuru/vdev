# サービス仕様書テンプレート調査レポート

## 背景

新規プロダクト立ち上げ時に、サービス仕様書を作成し `/adev` コマンドで完全自律開発するフローを標準化したい。既存の2つのサービス仕様書を分析し、テンプレートの設計指針を導出する。

## 分析対象

| 仕様書 | プロダクト | 技術スタック | 特性 |
|---|---|---|---|
| `gale/docs/hokatsu-optimization-service-spec.md` | 保活最適化ツール | Python CLI | アルゴリズム中心、PDF スクレイピング、モンテカルロシミュレーション |
| `brillat/docs/brillat-spec.md` | グルメ通販 AI エージェント | TypeScript + Claude Code | マルチエージェント構成、LINE 連携、Web スクレイピング |

## 調査結果

### 2つの仕様書の構造比較

| セクション | hokatsu (Python CLI) | brillat (TypeScript Agent) | 共通性 |
|---|---|---|---|
| サービス概要 | ビジョン・課題・ターゲット | ビジョン・課題・ターゲット・UX 全体像 | **共通** |
| 機能/設計 | 機能一覧 + アルゴリズム設計 | エージェント構成 + 通知設計 | **ドメイン固有** |
| データ設計 | エンティティ + データ収集戦略 | エンティティ（簡潔） | **共通** |
| 外部 IF | CLI 外部仕様（詳細） | 通知メッセージ仕様 | **ドメイン固有** |
| 技術スタック | テーブル + 構成図 | テーブル + 構成図 | **共通** |
| 開発ロードマップ | §6.1 RFC 一覧 + 依存関係図 | §6.1 RFC 一覧 | **共通（/adev 必須）** |
| AI 実装ガイド | §6.4 実装スコープの定義 | §6.1 冒頭の ⚠️ 警告 | **共通（形式不統一）** |
| スコープ外 | §2.2 | §6.2 | **共通（配置不統一）** |
| リスクと対策 | テーブル形式 | テーブル形式 | **共通** |
| 運用設計 | gitignore 設計 | gitignore + ログ設計 | **共通** |

### /adev との接続要件

`/adev` は仕様書から以下を抽出する:

1. **RFC 一覧テーブル**（デフォルト §6.1）— `slug`, `scope/概要`, `depends_on` の3列が必須
2. **仕様書全文** — `/arfc` に渡され、RFC 作成のコンテキストとなる

テンプレートは「/adev が正しくパースできる RFC 一覧テーブル」と「AI が良質な RFC を生成するのに十分なドメイン知識」の両方を満たす必要がある。

### 業界ベストプラクティス

IEEE 830 / ISO 29148 の SRS 構造と、2つの実績ある仕様書の分析から、以下の設計原則を導出した:

- **テスト可能な要件記述**: 各機能要件は検証可能な形で記述する（[Perforce SRS Guide](https://www.perforce.com/blog/alm/how-write-software-requirements-specification-srs-document)）
- **スコープ外の明示**: 「やらないこと」を明示することで、AI が過剰実装するリスクを抑制する（[Atlassian Product Specification](https://www.atlassian.com/agile/product-management/product-specification)）
- **変更履歴の管理**: 仕様書は living document として進化するため、バージョン管理が必須（[Archbee Technical Spec Guide](https://www.archbee.com/blog/technical-specification)）

## 提案: テンプレート構造

### 設計方針

必須セクション（全プロダクト共通）と任意セクション（ドメイン固有）を明示する2層構造とする。

### テンプレート構成

```
# {プロダクト名} サービス仕様書 v1.0

## 変更履歴

## 1. サービス概要                    ← 必須
  ### 1.1 プロダクトビジョン
  ### 1.2 解決する課題
  ### 1.3 ターゲットユーザー
  ### 1.4 ユーザー体験の全体像

## 2. 機能要件                        ← 必須
  ### 2.1 機能一覧
  ### 2.2 スコープ外

## 3. ドメイン設計                    ← 自由記述（プロダクト固有）
  （アルゴリズム / エージェント構成 / ビジネスルール 等）

## 4. データ設計                      ← 必須
  ### 4.1 主要エンティティ
  ### 4.2 データ取得・管理戦略（該当時のみ）

## 5. 外部インターフェース設計        ← 自由記述（プロダクト固有）
  （CLI / API / 通知 / UI 等）

## 6. 技術アーキテクチャ              ← 必須
  ### 6.1 技術スタック
  ### 6.2 システム構成

## 7. 開発ロードマップ                ← 必須（/adev エントリポイント）
  ### 7.1 RFC 一覧                   ← /adev パース対象
  ### 7.2 依存関係図
  ### 7.3 実装完了の定義

## 8. リスクと対策                    ← 必須

## 9. 運用設計                        ← 必須
  ### 9.1 ディレクトリ構成
  ### 9.2 gitignore 設計
  ### 9.3 ログ設計（該当時のみ）
```

### 既存仕様書からの改善点

| 現状の問題 | テンプレートでの対策 |
|---|---|
| 「スコープ外」の配置が §2.2 と §6.2 で不統一 | §2.2 に統一（機能要件と対で定義するのが自然） |
| AI 向け実装警告が §6.4 と §6.1 冒頭で形式不統一 | §7.3「実装完了の定義」として独立セクション化 |
| ドメイン固有設計が §2〜§4 に散在 | §3「ドメイン設計」として自由記述セクションを明示 |
| RFC 一覧テーブルの列名が仕様書間で微妙に異なる | `RFC`, `slug`, `概要`, `依存` の4列に統一 |
| 運用設計（gitignore, ログ）が末尾にバラバラ配置 | §9「運用設計」にまとめる |

### /adev との接続

- RFC 一覧テーブルは §7.1 に配置
- `/adev` のデフォルトセクションは `6.1` のため、実行時に `/adev spec.md 7.1` と指定する
- テーブル列は `slug`（識別子）, `概要`（スコープ）, `依存`（depends_on）を含む → /adev のパース要件を満たす
- 代替案として `/adev` のデフォルトセクションを `7.1` に変更する方法もある（影響範囲は `/adev` コマンド定義の1行のみ）

## 次のアクション

- テンプレート内容の承認後、`templates/service-spec/` に配置する
- 必要に応じて `/adev` のデフォルトセクションを `7.1` に変更する
