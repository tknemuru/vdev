# vdevフロー改善調査レポート

**作成日**: 2026-02-04
**目的**: vdevフロー全体の速度改善・品質向上の余地を調査

---

## 1. 現状のフロー構成

vdevは **RFC駆動開発ワークフロー** に基づき、4つのステージで構成される。

```
Stage 1: Drafting (RFC作成)
    ↓
Stage 2: Reviewing (設計レビュー)
    ↓
Stage 3: Implementing (実装)
    ↓
Stage 4: Closing (完了)
```

### ステージ・コマンド対応

| ステージ | コマンド | 主な処理 |
|---------|---------|---------|
| Stage 1: Drafting | `/rfc` | RFC起草、Draft PR作成 |
| Stage 2: Reviewing | `/rrfc` `/urfc` | 3人格並列レビュー、RFC修正 |
| Stage 3: Implementing | `/imp` `/rimp` `/uimp` | 実装、3人格並列レビュー、修正 |
| Stage 4: Closing | `/upr` | PRコメント対応 |

### フロー図

```
┌─────────────────────────────────────────────────────────────┐
│ STAGE 1: DRAFTING                                           │
│ ┌──────────────┐                                            │
│ │   /rfc       │  → docs/rfcs/<slug>/rfc.md                │
│ │              │  → rfc/<slug> ブランチ作成                 │
│ │              │  → Draft PR 作成                           │
│ └──────┬───────┘                                            │
│        ↓                                                     │
├─────────────────────────────────────────────────────────────┤
│ STAGE 2: REVIEWING                                          │
│ ┌──────────────┐                                            │
│ │  /rrfc       │  → review-approach.md                      │
│ │  [3並列]     │  → review-security-risk.md                 │
│ │              │  → review-quality.md                       │
│ └──┬───────┬───┘                                            │
│    │       │                                                │
│    ├─ 全Approve → RFC status="Accepted", PR Ready          │
│    │                                                         │
│    └─ Request Changes                                        │
│              ↓                                               │
│      ┌──────────────┐                                       │
│      │   /urfc      │  → rfc.md 修正 → /rrfc 再実行        │
│      └──────────────┘                                       │
├─────────────────────────────────────────────────────────────┤
│ STAGE 3: IMPLEMENTING                                       │
│ ┌──────────────┐                                            │
│ │   /imp       │  → feature/<slug> ブランチ作成             │
│ │              │  → 実装・テスト・Draft PR作成              │
│ └──────┬───────┘                                            │
│        ↓                                                     │
│ ┌──────────────┐                                            │
│ │  /rimp       │  → review-imp-*.md (3ファイル)            │
│ │  [3並列]     │                                            │
│ └──┬───────┬───┘                                            │
│    │       │                                                │
│    ├─ 全Approve → PR Ready                                  │
│    │                                                         │
│    └─ Request Changes                                        │
│              ↓                                               │
│      ┌──────────────┐                                       │
│      │   /uimp      │  → コード修正 → /rimp 再実行         │
│      └──────────────┘                                       │
├─────────────────────────────────────────────────────────────┤
│ STAGE 4: CLOSING                                            │
│ ┌──────────────┐                                            │
│ │   /upr       │  → PRコメント対応 → 人間がマージ          │
│ └──────────────┘                                            │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 速度改善の余地

### 評価: 大幅な改善余地は限定的

#### 既に最適化されている点

- **3人格レビューの並列実行**: `/rrfc`, `/rimp` でTaskツールによる並列発行済み
- **自動化スクリプト**: `rfc-init`, `rfc-publish` でブランチ・PR操作を自動化
- **大規模差分の分割処理**: 3000行超で自動分割レビュー

#### 改善可能な点（中程度の効果）

| 改善案 | 内容 | 期待効果 |
|--------|------|----------|
| RFC+実装の統合オプション | 小規模タスク用に `/quick` コマンド追加（RFC省略可能なケース） | 小タスクの速度2-3倍 |
| レビュー省略フラグ | 明らかに軽微な修正時、レビュー1人格のみ実行 | レビュー時間1/3 |
| 事前キャッシュ | システム概要ドキュメントの事前読み込み・要約キャッシュ | 各コマンド初期化時間短縮 |
| 差分ベースの選択的レビュー | 変更種別（テストのみ、ドキュメントのみ等）で必要なレビュアーを自動選択 | 不要レビュー削減 |

---

## 3. 品質向上の余地

### 評価: いくつかの改善余地あり

#### 既に高品質を担保している点

- **2段階ゲート**: RFC承認 → 実装承認
- **3人格による多角的レビュー**: Approach / Security&Risk / Technical Quality
- **明確なDoD**: 各ステージで完了条件を定義
- **Living Document**: RFC-実装の同期義務

#### 改善可能な点

| 改善案 | 内容 | 期待効果 |
|--------|------|----------|
| 実装後のRFC整合性検証 | `/rimp` でRFCとコードの乖離を自動検出・警告 | 設計と実装の齟齬防止 |
| 累積的セキュリティチェック | 複数RFCにまたがる変更の影響分析 | システム全体のリスク可視化 |
| レビュー品質のメタ評価 | レビュー結果の網羅性・深度を評価する仕組み | レビュー品質の底上げ |
| 過去レビュー学習 | 頻出指摘パターンをRFC/実装時に事前警告 | 同種問題の予防 |
| テストカバレッジ連携 | `/rimp` でカバレッジ低下を検出・警告 | テスト品質の維持 |
| アーキテクチャ整合性チェック | `docs/architecture.md` との自動整合性検証 | 設計原則からの逸脱防止 |

---

## 4. 総合評価

| 観点 | 現状評価 | 大幅改善余地 |
|------|---------|-------------|
| 速度 | ★★★★☆ (並列化済み) | 限定的 |
| 品質 | ★★★★☆ (2段階+3人格) | 中程度あり |

---

## 5. 推奨アクション（優先度順）

1. **[品質] 実装-RFC整合性の自動検証追加** - `/rimp` に乖離検出ロジック追加
2. **[速度] 軽量パス `/quick` の導入** - RFC不要な小タスク向け
3. **[品質] テストカバレッジ連携** - カバレッジ低下時の警告機構
4. **[速度] 変更種別による選択的レビュー** - テストのみ変更時はQualityレビューのみ等

---

## 6. 結論

現状のフローは構造的によく設計されており、「大幅な」改善というよりは、特定ケースの最適化や追加チェックによる漸進的改善が現実的である。

特に効果が高いのは：
- 小規模タスク向けの軽量パス導入（速度）
- 実装-RFC整合性の自動検証（品質）
