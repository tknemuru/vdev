# /rfc - RFC作成コマンド

以下の手順に従い、RFCドキュメントを作成せよ。

## 元ネタ文章

$ARGUMENTS

## 実行手順

### Step 1: 元ネタ文章の取得

上記「元ネタ文章」が空の場合は、「RFCの元ネタを入力してください。」とだけ表示し、ユーザの次のメッセージを待て。入力がある場合はそれを元ネタ文章として使用する。

### Step 2: slugstr 生成

元ネタ文章の内容を要約し、**最大30文字**の全小文字ケバブケース英数字（a-z, 0-9, ハイフンのみ）で `slugstr` を生成せよ。

### Step 3: 初期化（シェルスクリプト）

以下のコマンドを実行せよ。出力される文字列が完全な `slug`（YYYYMMDD-slugstr）である。以降のステップではこの `slug` を使用する。

```bash
rfc-init <slugstr>
```

このスクリプトは以下を自動実行する:
- JST日付を付与した slug の生成
- デフォルトブランチから `rfc/<slug>` ブランチを作成・チェックアウト
- `docs/rfcs/<slug>/` ディレクトリを作成
- テンプレートを `docs/rfcs/<slug>/rfc.md` にコピー

### Step 4: 要件ヒアリング

元ネタ文章を分析し、RFC起草に必要な情報が不足・曖昧な場合は、起草前にユーザへ質問して要件を明確化せよ。十分に明確な場合はこのステップをスキップしてよい。

### Step 5: コードベース調査

#### 5a. ドメイン知識の取得

カレントリポジトリのルート（`git rev-parse --show-toplevel`）を基準に、以下のシステム概要ドキュメントが存在する場合は**並列に（単一メッセージ内で同時に）**読み込め（存在しないファイルはスキップ）:
- `docs/architecture.md`
- `docs/domain-model.md`
- `docs/api-overview.md`

これらのドキュメントからは **ドメイン知識**（業務ルール、運用要件、ドメインの常識）と **構造的オリエンテーション**（どのコンポーネントがどの責務を担うか、どこを見ればいいか）を取得する。

#### 5b. 技術的事実の調査

元ネタ文章に関連するコードベースを直接調査し、現行の実装・データフロー・依存関係を把握せよ。技術的事実（コードの挙動、処理の流れ、データ構造）はコードが唯一の真実であり、System Overview Docs の記載ではなくコードから導出すること。

**注意**: System Overview Docs に技術的事実の記載がある場合でも、それを無条件に信頼してはならない。コードと docs の記載に矛盾がある場合は、コードを正とする。

#### 5c. 調査結果の反映

ドメイン知識とコード調査の結果を統合し、Step 6 の起草時に「背景・動機」「詳細設計」へ反映する。

### Step 6: RFC起草

1. `~/projects/vdev/prompts/roles/rfc-author.md` を読み込み、その人格に切り替わる。
2. `docs/rfcs/<slug>/rfc.md` のテンプレート構造に従い、元ネタ文章とコードベース調査結果をもとにRFCを起草する。
3. ステータスは「Draft (起草中)」、作成日は今日のJST日付（YYYY-MM-DD形式）とする。
4. 起草した内容を `docs/rfcs/<slug>/rfc.md` に書き込む。
5. 「ドキュメント編集仕様」セクション起草時に、システム概要ドキュメント（`docs/architecture.md`, `docs/domain-model.md`, `docs/api-overview.md`）への影響を判断し、影響がある場合は更新を対応項目として明記せよ。

### Step 7: DoD自己チェック

起草したRFCが以下の完了定義を満たしているか自己チェックし、不足があれば補完せよ。

- [ ] 背景・動機が5文以内の散文で記述されていること
- [ ] 機能要件が要件テーブルで記述されていること
- [ ] 非機能要件が分類付き要件テーブルで記述されていること
- [ ] 実現方式が要件と方針の対応テーブルで記述されていること
- [ ] 代替案が最低2案比較されていること
- [ ] 外部仕様がユーザ視点で記述されていること
- [ ] 結合テスト仕様がテーブル形式で記述されていること
- [ ] ドキュメント編集仕様にシステム概要ドキュメントへの影響が判断されていること
- [ ] Task計画がPhase/フェーズで分割されていないこと
- [ ] Task計画の全作業項目が単一PRで完遂可能な規模であること
- [ ] 詳細設計に単体テスト仕様が含まれていること
- [ ] 記述形式ルールに違反していないこと（80文字上限・散文禁止・コード識別子禁止）

### Step 8: パブリッシュ（シェルスクリプト）

以下のコマンドを実行せよ。

```bash
rfc-publish <slug>
```

このスクリプトは以下を自動実行する:
- `docs/rfcs/<slug>/rfc.md` のステージング
- コミット（メッセージ: `docs: add RFC draft for <slug>`）
- `rfc/<slug>` ブランチをリモートにプッシュ
- Draft PR の作成（未作成の場合）

完了後、作成したRFCのファイルパス・ブランチ名・PR URLをユーザに報告せよ。
